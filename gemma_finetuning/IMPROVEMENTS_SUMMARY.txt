================================================================================
üìä –£–õ–£–ß–®–ï–ù–ò–Ø –î–õ–Ø –†–ê–ë–û–¢–´ –° –î–ò–°–ë–ê–õ–ê–ù–°–û–ú –ö–õ–ê–°–°–û–í
================================================================================

‚úÖ –ß–¢–û –î–û–ë–ê–í–õ–ï–ù–û:

1. FOCAL LOSS (gamma=2.0)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö
   - –°–Ω–∏–∂–∞–µ—Ç –≤–ª–∏—è–Ω–∏–µ –ª–µ–≥–∫–∏—Ö/—á–∞—Å—Ç—ã—Ö –∫–ª–∞—Å—Å–æ–≤
   - –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ FOCAL_LOSS_GAMMA

2. CLASS WEIGHTS
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞
   - –†–µ–¥–∫–∏–µ –∫–ª–∞—Å—Å—ã –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–∏–π –≤–µ—Å –≤ loss function
   - –í–µ—Å–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ outputs/class_weights.json

3. –£–õ–£–ß–®–ï–ù–ù–´–ï –ú–ï–¢–†–ò–ö–ò
   - F1 Macro: —Å—Ä–µ–¥–Ω–µ–µ –ø–æ –≤—Å–µ–º –∫–ª–∞—Å—Å–∞–º (–≥–ª–∞–≤–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞!)
   - F1 Micro: –æ–±—â–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
   - Accuracy: –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
   - –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ F1 Macro

4. CUSTOM TRAINER (WeightedLossTrainer)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ weighted loss
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è focal loss
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ padding —Ç–æ–∫–µ–Ω–æ–≤

5. –î–ï–¢–ê–õ–¨–ù–û–ï –õ–û–ì–ò–†–û–í–ê–ù–ò–ï
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ—Å–æ–≤ –∫–ª–∞—Å—Å–æ–≤
   - –ê–Ω–∞–ª–∏–∑ —á–∞—Å—Ç—ã—Ö/—Ä–µ–¥–∫–∏—Ö –∫–ª–∞—Å—Å–æ–≤
   - –ü–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã evaluation

================================================================================
üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:
================================================================================

–•–æ—Ä–æ—à–µ–µ –æ–±—É—á–µ–Ω–∏–µ:
  ‚Ä¢ F1 Macro: 0.60-0.80
  ‚Ä¢ F1 Micro: 0.75-0.90
  ‚Ä¢ F1 Macro –±–ª–∏–∑–∫–æ –∫ F1 Micro

–ü–ª–æ—Ö–æ–µ –æ–±—É—á–µ–Ω–∏–µ:
  ‚Ä¢ F1 Macro < 0.50
  ‚Ä¢ –ë–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É F1 Macro –∏ F1 Micro
  ‚Ä¢ –ú–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—ã–µ –∫–ª–∞—Å—Å—ã

================================================================================
‚öôÔ∏è –û–°–ù–û–í–ù–´–ï –ü–ê–†–ê–ú–ï–¢–†–´:
================================================================================

–í scripts/train_qlora.py:

USE_CLASS_WEIGHTS = True        # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–µ—Å–∞ –∫–ª–∞—Å—Å–æ–≤
USE_WEIGHTED_SAMPLER = True     # –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ
FOCAL_LOSS_GAMMA = 2.0          # 0 = –æ–±—ã—á–Ω–∞—è CE loss, 2-3 = focal loss

metric_for_best_model="eval_f1_macro"  # –í—ã–±–æ—Ä –ª—É—á—à–µ–π –º–æ–¥–µ–ª–∏ –ø–æ F1 Macro

================================================================================
üöÄ –ó–ê–ü–£–°–ö –û–ë–£–ß–ï–ù–ò–Ø:
================================================================================

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
conda activate rpa

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±—É—á–µ–Ω–∏–µ
cd /home/zarina/Work/RPA/gemma_finetuning
python scripts/train_qlora.py

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
tensorboard --logdir logs

# –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è - –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞
python scripts/evaluate.py

================================================================================
üìä –ù–ê–®–ò –î–ê–ù–ù–´–ï:
================================================================================

‚Ä¢ –í—Å–µ–≥–æ –∫–ª–∞—Å—Å–æ–≤: 72
‚Ä¢ –í—Å–µ–≥–æ –ø—Ä–∏–º–µ—Ä–æ–≤: 388,666
  - Train: 272,066 (70%)
  - Val: 58,300 (15%)
  - Test: 58,300 (15%)

‚Ä¢ –î–∏—Å–±–∞–ª–∞–Ω—Å:
  - –¢–æ–ø –∫–ª–∞—Å—Å (10151): 101,385 –ø—Ä–∏–º–µ—Ä–æ–≤ (26%)
  - –†–µ–¥–∫–∏–µ –∫–ª–∞—Å—Å—ã: –æ—Ç 8 –ø—Ä–∏–º–µ—Ä–æ–≤
  - –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ: ~2600x

‚Ä¢ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
  - 80102 ‚Üí 80101 (–æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã, –æ–ø–µ—á–∞—Ç–∫–∞)
  - 100201 ‚Üí –æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ "–ü—Ä–æ—á–µ–µ"
  - 10151 ‚Üí –æ—Å—Ç–∞–≤–ª–µ–Ω (–Ω–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä–µ, –Ω–æ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö)

================================================================================
üìÅ –ü–û–õ–ï–ó–ù–´–ï –§–ê–ô–õ–´:
================================================================================

CLASS_BALANCING.md              - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
scripts/train_qlora.py          - –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
data/metadata.json              - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
outputs/class_weights.json      - –í–µ—Å–∞ –∫–ª–∞—Å—Å–æ–≤ (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞)

================================================================================
üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:
================================================================================

1. –°–ª–µ–¥–∏—Ç–µ –∑–∞ F1 Macro –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è (–¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏)
2. –ï—Å–ª–∏ F1 Macro << F1 Micro - –º–æ–¥–µ–ª—å –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —Ä–µ–¥–∫–∏–µ –∫–ª–∞—Å—Å—ã
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ TensorBoard –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
4. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ evaluate.py
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∞ —Ä–µ–¥–∫–∏—Ö –∫–ª–∞—Å—Å–∞—Ö –æ—Ç–¥–µ–ª—å–Ω–æ

================================================================================

